<!DOCTYPE html>
<html th:lang="${#locale.language}" th:dir="#{language.direction}" th:data-language="${#locale.toString()}" xmlns:th="https://www.thymeleaf.org">
  <head>
  <th:block th:insert="~{fragments/common :: head(title=#{watermark.title}, header=#{watermark.header})}"></th:block>
  </head>

  <body onload="toggleFileOption()">
    <div id="page-container">
      <div id="content-wrap">
        <th:block th:insert="~{fragments/navbar.html :: navbar}"></th:block>
        <br><br>
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-md-6 bg-card">
              <div class="tool-header">
                <span class="material-symbols-rounded tool-header-icon security">water_drop</span>
                <span class="tool-header-text" th:text="#{watermark.header}"></span>
              </div>

              <form method="post" enctype="multipart/form-data" th:action="@{'api/v1/security/add-watermark'}">
                <div class="mb-3">
                  <label th:text="#{watermark.selectText.1}"></label>
                  <div th:replace="~{fragments/common :: fileSelector(name='fileInput', multipleInputsForSingleRequest=false, accept='application/pdf')}"></div>
                </div>

                <div class="mb-3">
                  <label th:text="#{watermark.selectText.8}"></label>
                  <select class="form-control" id="watermarkType" name="watermarkType" onchange="toggleFileOption()">
                    <option value="text" th:text="#{watermark.type.1}"></option>
                    <option value="image" th:text="#{watermark.type.2}"></option>
                  </select>
                </div>
                <div id="alphabetGroup" class="mb-3">
                  <label for="fontSize" th:text="#{alphabet} + ':'"></label>
                  <select class="form-control" name="alphabet" id="alphabet-select">
                    <option value="roman">Roman</option>
                    <option value="arabic">العربية</option>
                    <option value="japanese">日本語</option>
                    <option value="korean">한국어</option>
                    <option value="chinese">简体中文</option>
                  </select>
                </div>
                <div id="watermarkTextGroup" class="mb-3">
                  <label for="watermarkText" th:text="#{watermark.selectText.2}"></label>
                  <input type="text" id="watermarkText" name="watermarkText" class="form-control" placeholder="Stirling-PDF" required>
                </div>

                <div id="watermarkImageGroup" class="mb-3" style="display: none;">
                  <label for="watermarkImage" th:text="#{watermark.selectText.9}"></label>
                  <input type="file" id="watermarkImage" name="watermarkImage" class="form-control-file" accept="image/*">
                </div>

                <div class="mb-3">
                  <label for="fontSize" th:text="#{watermark.selectText.3}"></label>
                  <input type="text" id="fontSize" name="fontSize" class="form-control" value="30">
                </div>
                <div class="mb-3">
                  <label for="opacity" th:text="#{watermark.selectText.7}"></label>
                  <input type="text" id="opacity" name="opacityText" class="form-control" value="50" onblur="updateOpacityValue()">
                  <input type="hidden" id="opacityReal" name="opacity" value="0.5">
                </div>
                <script>
                  const opacityInput = document.getElementById('opacity');
                  const opacityRealInput = document.getElementById('opacityReal');

                  const updateOpacityValue = () => {
                    let percentageValue = parseFloat(opacityInput.value.replace('%', ''));
                    if (isNaN(percentageValue)) {
                      percentageValue = 0;
                    }
                    percentageValue = Math.min(Math.max(percentageValue, 0), 100);
                    opacityInput.value = `${percentageValue}`;
                    opacityRealInput.value = (percentageValue / 100).toFixed(2);
                  };

                  const appendPercentageSymbol = () => {
                    if (!opacityInput.value.endsWith('%')) {
                      opacityInput.value += '%';
                    }
                  };

                  opacityInput.addEventListener('focus', () => {
                    opacityInput.value = opacityInput.value.replace('%', '');
                  });
                  opacityInput.addEventListener('blur', () => {
                    updateOpacityValue();
                    appendPercentageSymbol();
                  });

                  // Set initial values
                  updateOpacityValue();
                  appendPercentageSymbol();
                </script>

                        <div class="mb-3">
                            <label for="rotation" th:text="#{watermark.selectText.4}"></label>
                            <input type="text" id="rotation" name="rotation" class="form-control" value="45">
                        </div>
                        <div class="mb-3">
                            <label for="widthSpacer" th:text="#{watermark.selectText.5}"></label>
                            <input type="text" id="widthSpacer" name="widthSpacer" class="form-control" value="50">
                        </div>
                        <div class="mb-3">
                            <label for="heightSpacer" th:text="#{watermark.selectText.6}"></label>
                            <input type="text" id="heightSpacer" name="heightSpacer" class="form-control" value="50">
                        </div>
                        <div class="mb-3">
                            <label for="customColor" class="form-label" th:text="#{watermark.customColor}">Custom
                                Color</label>
                            <div class="form-control form-control-color" style="background-color: #d3d3d3;">
                                <input type="color" id="customColor" name="customColor" value="#d3d3d3">
                            </div>
                            <script>
                                let colorInput = document.getElementById("customColor");
                                if (colorInput) {
                                  let colorInputContainer = colorInput.parentElement;
                                  if (colorInputContainer) {
                                    colorInput.onchange = function() {
                                      colorInputContainer.style.backgroundColor = colorInput.value;
                                    }
                                    colorInputContainer.style.backgroundColor = colorInput.value;
                                  }
                                }

                            </script>
                        </div>


                        <!-- Random Options Section -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h5>Random Options</h5>
                            </div>
                            <div class="card-body">
                                <!-- Positioning Type -->
                                <div class="mb-3">
                                    <label for="positioningType">Positioning Type:</label>
                                    <select class="form-control" id="positioningType" name="positioningType" onchange="toggleRandomOptions()">
                                        <option value="fixed">Fixed</option>
                                        <option value="random">Random</option>
                                    </select>
                                </div>

                                <!-- Orientation Type -->
                                <div class="mb-3">
                                    <label for="orientationType">Orientation Type:</label>
                                    <select class="form-control" id="orientationType" name="orientationType" onchange="toggleRandomOptions()">
                                        <option value="fixed">Fixed</option>
                                        <option value="random">Random</option>
                                    </select>
                                </div>

                                <!-- Min/Max Rotation Angles (initially hidden) -->
                                <div id="rotationRangeGroup" class="mb-3" style="display: none;">
                                    <div class="row">
                                        <div class="col">
                                            <label for="minRotation">Min Rotation:</label>
                                            <input type="text" id="minRotation" name="minRotation" class="form-control" value="0">
                                        </div>
                                        <div class="col">
                                            <label for="maxRotation">Max Rotation:</label>
                                            <input type="text" id="maxRotation" name="maxRotation" class="form-control" value="360">
                                        </div>
                                    </div>
                                </div>

                                <!-- Text-specific random options -->
                                <div id="textRandomOptions">
                                    <!-- Font Selection Type -->
                                    <div class="mb-3">
                                        <label for="fontSelectionType">Font Selection Type:</label>
                                        <select class="form-control" id="fontSelectionType" name="fontSelectionType" onchange="toggleRandomOptions()">
                                            <option value="fixed">Fixed</option>
                                            <option value="random">Random</option>
                                        </select>
                                    </div>

                                    <!-- Font Size Type -->
                                    <div class="mb-3">
                                        <label for="fontSizeType">Font Size Type:</label>
                                        <select class="form-control" id="fontSizeType" name="fontSizeType" onchange="toggleRandomOptions()">
                                            <option value="fixed">Fixed</option>
                                            <option value="random">Random</option>
                                        </select>
                                    </div>

                                    <!-- Min/Max Font Size (initially hidden) -->
                                    <div id="fontSizeRangeGroup" class="mb-3" style="display: none;">
                                        <div class="row">
                                            <div class="col">
                                                <label for="minFontSize">Min Font Size:</label>
                                                <input type="text" id="minFontSize" name="minFontSize" class="form-control" value="20">
                                            </div>
                                            <div class="col">
                                                <label for="maxFontSize">Max Font Size:</label>
                                                <input type="text" id="maxFontSize" name="maxFontSize" class="form-control" value="40">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Color Type -->
                                    <div class="mb-3">
                                        <label for="colorType">Color Type:</label>
                                        <select class="form-control" id="colorType" name="colorType" onchange="toggleRandomOptions()">
                                            <option value="fixed">Fixed</option>
                                            <option value="random">Random</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Per-Letter Customization Section -->
                        <div class="card mb-3" id="perLetterSection">
                            <div class="card-header">
                                <h5>Per-Letter Customization</h5>
                            </div>
                            <div class="card-body">
                                <p class="text-muted">Enable these options to apply different properties to each letter in the watermark text.</p>

                                <!-- Per-Letter Font -->
                                <div class="mb-3 form-check">
                                    <input type="checkbox" id="perLetterFont" name="perLetterFont" class="form-check-input">
                                    <label for="perLetterFont" class="form-check-label">Per-Letter Font Variation</label>
                                </div>

                                <!-- Per-Letter Color -->
                                <div class="mb-3 form-check">
                                    <input type="checkbox" id="perLetterColor" name="perLetterColor" class="form-check-input">
                                    <label for="perLetterColor" class="form-check-label">Per-Letter Color Variation</label>
                                </div>

                                <!-- Per-Letter Size -->
                                <div class="mb-3 form-check">
                                    <input type="checkbox" id="perLetterSize" name="perLetterSize" class="form-check-input">
                                    <label for="perLetterSize" class="form-check-label">Per-Letter Size Variation</label>
                                </div>

                                <!-- Per-Letter Orientation -->
                                <div class="mb-3 form-check">
                                    <input type="checkbox" id="perLetterOrientation" name="perLetterOrientation" class="form-check-input">
                                    <label for="perLetterOrientation" class="form-check-label">Per-Letter Orientation Variation</label>
                                </div>
                            </div>
                        </div>

                        <!-- Advanced Features Section -->
                        <div class="card mb-3" id="advancedFeaturesSection">
                            <div class="card-header">
                                <h5>Advanced Features</h5>
                            </div>
                            <div class="card-body">
                                <!-- Watermark Count -->
                                <div class="mb-3" id="watermarkCountGroup">
                                    <label for="watermarkCount">Number of Watermarks (for random positioning):</label>
                                    <input type="number" id="watermarkCount" name="watermarkCount" class="form-control" value="10" min="1" max="100">
                                    <small class="form-text text-muted">Number of watermarks to place when using random positioning.</small>
                                </div>

                                <!-- Shading Type -->
                                <div class="mb-3" id="shadingTypeGroup">
                                    <label for="shadingType">Shading Type:</label>
                                    <select class="form-control" id="shadingType" name="shadingType">
                                        <option value="none">None</option>
                                        <option value="linear">Linear</option>
                                        <option value="radial">Radial</option>
                                        <option value="random">Random</option>
                                    </select>
                                    <small class="form-text text-muted">Apply shading effects to text watermarks.</small>
                                </div>

                                <!-- Random Mirroring -->
                                <div class="mb-3 form-check">
                                    <input type="checkbox" id="enableRandomMirroring" name="enableRandomMirroring" class="form-check-input">
                                    <label for="enableRandomMirroring" class="form-check-label">Enable Random Mirroring</label>
                                    <small class="form-text text-muted d-block">Randomly flip watermarks horizontally or vertically.</small>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3 form-check">
                            <input type="checkbox" id="convertPDFToImage" name="convertPDFToImage">
                            <label for="convertPDFToImage" th:text="#{watermark.selectText.10}"></label>
                        </div>
                        <div class="mb-3 text-left">
                            <button type="submit" id="submitBtn" class="btn btn-primary" th:text="#{watermark.submit}"></button>
                        </div>
                    </form>

              <script>
                function toggleFileOption() {
                  const watermarkType = document.getElementById('watermarkType').value;
                  const watermarkTextGroup = document.getElementById('watermarkTextGroup');
                  const watermarkImageGroup = document.getElementById('watermarkImageGroup');
                  const alphabetGroup = document.getElementById('alphabetGroup');
                  const watermarkText = document.getElementById('watermarkText');
                  const watermarkImage = document.getElementById('watermarkImage');
                  const textRandomOptions = document.getElementById('textRandomOptions');
                  const perLetterSection = document.getElementById('perLetterSection');
                  const advancedFeaturesSection = document.getElementById('advancedFeaturesSection');
                  const shadingTypeGroup = document.getElementById('shadingTypeGroup');

                  if (watermarkType === 'text') {
                    if (watermarkImage.hasAttribute('required')) {
                      watermarkImage.removeAttribute('required');
                    }
                    watermarkTextGroup.style.display = 'block';
                    watermarkText.required = true;
                    watermarkImageGroup.style.display = 'none';
                    watermarkImage.required = false;
                    alphabetGroup.style.display = 'block';
                    textRandomOptions.style.display = 'block';
                    perLetterSection.style.display = 'block'; // Show per-letter options for text watermarks
                    advancedFeaturesSection.style.display = 'block'; // Show advanced features for text watermarks
                    shadingTypeGroup.style.display = 'block'; // Show shading options for text watermarks
                  } else if (watermarkType === 'image') {
                    if (watermarkImage.hasAttribute('required')) {
                      watermarkImage.removeAttribute('required');
                    }
                    watermarkTextGroup.style.display = 'none';
                    watermarkText.required = false;
                    watermarkImageGroup.style.display = 'block';
                    watermarkImage.required = true;
                    alphabetGroup.style.display = 'none';
                    textRandomOptions.style.display = 'none';
                    perLetterSection.style.display = 'none'; // Hide per-letter options for image watermarks
                    advancedFeaturesSection.style.display = 'block'; // Show advanced features for image watermarks
                    shadingTypeGroup.style.display = 'none'; // Hide shading options for image watermarks
                  }

                  // Make sure random options are properly toggled
                  toggleRandomOptions();
                }

                function toggleRandomOptions() {
                  // Toggle rotation range inputs
                  const orientationType = document.getElementById('orientationType').value;
                  const rotationRangeGroup = document.getElementById('rotationRangeGroup');

                  if (orientationType === 'random') {
                    rotationRangeGroup.style.display = 'block';
                  } else {
                    rotationRangeGroup.style.display = 'none';
                  }

                  // Toggle font size range inputs
                  const fontSizeType = document.getElementById('fontSizeType').value;
                  const fontSizeRangeGroup = document.getElementById('fontSizeRangeGroup');

                  if (fontSizeType === 'random') {
                    fontSizeRangeGroup.style.display = 'block';
                  } else {
                    fontSizeRangeGroup.style.display = 'none';
                  }

                  // Toggle alphabet selection based on font selection type
                  const fontSelectionType = document.getElementById('fontSelectionType').value;
                  const alphabetGroup = document.getElementById('alphabetGroup');
                  const watermarkType = document.getElementById('watermarkType').value;

                  if (watermarkType === 'text') {
                    if (fontSelectionType === 'random') {
                      alphabetGroup.style.display = 'none';
                    } else {
                      alphabetGroup.style.display = 'block';
                    }
                  }

                  // Toggle color picker based on color type
                  const colorType = document.getElementById('colorType').value;
                  const customColorContainer = document.getElementById('customColor').parentElement;

                  if (colorType === 'random') {
                    customColorContainer.style.display = 'none';
                  } else {
                    customColorContainer.style.display = 'block';
                  }

                  // Toggle watermark count input based on positioning type
                  const positioningType = document.getElementById('positioningType').value;
                  const watermarkCountGroup = document.getElementById('watermarkCountGroup');

                  if (positioningType === 'random') {
                    watermarkCountGroup.style.display = 'block';
                  } else {
                    watermarkCountGroup.style.display = 'none';
                  }

                  // Validate watermark count input
                  const watermarkCount = document.getElementById('watermarkCount');
                  watermarkCount.addEventListener('change', function() {
                    let count = parseInt(this.value);
                    if (isNaN(count) || count < 1) {
                      this.value = 1;
                    } else if (count > 100) {
                      this.value = 100;
                    }
                  });
                }
              </script>
            </div>
          </div>
        </div>
      </div>
      <th:block th:insert="~{fragments/footer.html :: footer}"></th:block>
    </div>
  </body>
</html>
